<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Posterior draws from a fitted model • ungeviz</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Posterior draws from a fitted model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ungeviz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/misc-geoms-stats.html">Miscellaneous geoms and stats</a>
    </li>
    <li>
      <a href="../articles/posterior-draws.html">Posterior draws from a fitted model</a>
    </li>
    <li>
      <a href="../articles/sampling-bootstrapping.html">Sampling and bootstrapping</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wilkelab/ungeviz">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Posterior draws from a fitted model</h1>
                        <h4 class="author">Claus O. Wilke</h4>
            
            <h4 class="date">2019-01-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wilkelab/ungeviz/blob/master/vignettes/posterior-draws.Rmd"><code>vignettes/posterior-draws.Rmd</code></a></small>
      <div class="hidden name"><code>posterior-draws.Rmd</code></div>

    </div>

    
    
<p>The ungeviz package provides several functions to generate outcome draws from a fitted model. Specifically, the model has to be a generalized additive model (GAM) fitted with the mgcv package. This is a very broad class of models that includes linear models and generalized linear models as special cases.</p>
<p>The simplest way to generate these outcome draws is via <code><a href="../reference/stat_smooth_draws.html">stat_smooth_draws()</a></code>, which works very similar to the regular <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth()</a></code>, with two important differences: it does not generate a confidence band, and it creates a new variable <code>.draw</code> that indicates distinct draws.</p>
<p>When we generate static plots, we need to use <code>.draw</code> to set the group aesthetic, usually via <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes(group = stat(.draw))</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ungeviz)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw)), <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/mpg-smooth-draws-1.png" width="480"></p>
<p>When making a HOP animation, we don’t necessarily have to set the <code>group</code> aesthetic, because we are now transitioning animation frames based on the distinct draws. Note that we have to use <code><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat(.draw)</a></code> instead of just <code>.draw</code> as the argument to <code><a href="https://www.rdocumentation.org/packages/gganimate/topics/transition_states">transition_states()</a></code>. The <code>.draw</code> column is not present in the original dataset, it is autogenerated by <code><a href="../reference/stat_smooth_draws.html">stat_smooth_draws()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gganimate)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(<span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/transition_states">transition_states</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw), <span class="dv">1</span>, <span class="dv">2</span>)</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/mpg-smooth-draws-animated-1.gif"><!-- --></p>
<p>If we don’t set the group aesthetic of <code><a href="../reference/stat_smooth_draws.html">stat_smooth_draws()</a></code>, gganimate will deform one smooth line until it looks like the next one. We may prefer to have the lines fade in and out, however. We can achieve this effect by setting the <code>group</code> aesthetic to <code><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat(.draw)</a></code>, so that gganimate sees the separate lines as distinct objects. We additionally add <code><a href="https://www.rdocumentation.org/packages/gganimate/topics/enter_exit">enter_fade()</a></code> and <code><a href="https://www.rdocumentation.org/packages/gganimate/topics/enter_exit">exit_fade()</a></code> to make the lines fade in and out.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(<span class="dt">size =</span> <span class="fl">0.5</span>, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw))) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/transition_states">transition_states</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/enter_exit">enter_fade</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/enter_exit">exit_fade</a></span>()</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/mpg-smooth-draws-fade-1.gif"><!-- --></p>
<p>The number of draws we generate is controlled by the <code>times</code> parameter of <code><a href="../reference/stat_smooth_draws.html">stat_smooth_draws()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(glue)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">plist &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">      </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">      </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">        <span class="dt">times =</span> .x,  <span class="co"># this line specifies the number of draws</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">        <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw)), <span class="dt">size =</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">      ) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="st">      </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">        <span class="st">"label"</span>, <span class="dt">x =</span> <span class="ot">Inf</span>, <span class="dt">y =</span> <span class="ot">Inf</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb4-14" data-line-number="14">        <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/glue/topics/glue">glue</a></span>(<span class="st">"{.x} draws"</span>, <span class="dt">size =</span> <span class="dv">12</span><span class="op">/</span>.pt)</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">      ) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="st">      </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb4-18" data-line-number="18"></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">cowplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(<span class="dt">plotlist =</span> plist)</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/changing-draw-numbers-1.png" width="576"></p>
<p>If we want to generate linear fits instead of spline fits, we can set the <code>formula</code> argument to <code>y ~ x</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw)), <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/mpg-linear-draws-1.png" width="480"></p>
<p>Under the hood, posterior draws are implemented via the function <code><a href="../reference/sample_outcomes.html">sample_outcomes()</a></code>, which can be used to generate a data frame with outcome samples. The accompanying function <code><a href="../reference/sample_outcomes.html">confidence_band()</a></code> can be used to generate a confidence band as well as the best-fit line.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mgcv)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co"># GAM spline fit</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">fit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mgcv/topics/gam">gam</a></span>(mpg <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mgcv/topics/s">s</a></span>(disp, <span class="dt">bs=</span> <span class="st">"cs"</span>), <span class="dt">data =</span> mtcars, <span class="dt">method =</span> <span class="st">"REML"</span>)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">newdata &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="dt">disp =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(mtcars<span class="op">$</span>disp), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(mtcars<span class="op">$</span>disp),</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">    <span class="dt">length.out =</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">sample_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_outcomes.html">sample_outcomes</a></span>(fit, newdata, <span class="dv">10</span>, <span class="dt">unconditional =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">conf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sample_outcomes.html">confidence_band</a></span>(fit, newdata, <span class="dt">unconditional =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="dt">data =</span> conf, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill=</span><span class="st">"#80808040"</span>, <span class="dt">color =</span> <span class="ot">NA</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="dt">color =</span> <span class="st">"grey30"</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> sample_df, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> .draw), <span class="dt">color =</span> <span class="st">"blue"</span>, <span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> conf, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">"darkred"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/gam-outcomes-manual-1.png" width="480"></p>
<p>It can happen that we want to group both by draws and by some other variable, in case we want to generate draws for multiple different subsets of the data at the same time. We can do so with one caveat. We have to use the mapped version of the respective data column (e.g., map it to <code>colour</code> and then use <code>colour</code> on the right side of the aesthetic specification) because we’re creating the groups after after initial data mapping. We can use <code><a href="https://www.rdocumentation.org/packages/base/topics/interaction">interaction()</a></code> to combine different grouping variables, e.g. here <code><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat(.draw)</a></code> and <code>colour</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg, <span class="dt">colour =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(cyl))) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="dt">times =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/interaction">interaction</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw), colour)),</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="dt">size =</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>)</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/mtcars-linear-1.png" width="480"></p>
<p>The same principle also works in animation. Note that we can show the entire ensemble of sampled draws in addition to the animated lines by adding <code><a href="https://www.rdocumentation.org/packages/gganimate/topics/shadow_mark">shadow_mark(future = TRUE, ...)</a></code>, where <code>...</code> stands for additional aesthetic settings that define how the ensemble is styled.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg, <span class="dt">colour =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(cyl))) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="dt">times =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/interaction">interaction</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw), colour)),</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">    <span class="dt">size =</span> <span class="fl">1.5</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/transition_states">transition_states</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw), <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/enter_exit">enter_fade</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/enter_exit">exit_fade</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/gganimate/topics/shadow_mark">shadow_mark</a></span>(<span class="dt">future =</span> <span class="ot">TRUE</span>, <span class="dt">size =</span> <span class="fl">0.25</span>, <span class="dt">color =</span> <span class="st">"gray50"</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/mtcars-linear-animation-1.gif"><!-- --></p>
<p>In a direct comparison between posterior draws and bootstrapped fits, we see that both approaches result in similar sets of curves, though bootstraps tend to cover the outcome space less uniformly, with curves being either very similar to each other or quite different. This happens because in bootstrapping the influence of individual data points varies in discrete steps, from nothing (when a data point is dropped in a bootstrap) to several multiples (when a data point is chosen three or four times).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">p1 &lt;-<span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/stat_smooth_draws.html">stat_smooth_draws</a></span>(<span class="dt">times =</span> <span class="dv">20</span>, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/stat.html">stat</a></span>(.draw)), <span class="dt">size =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Posterior draws"</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">p2 &lt;-<span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(mtcars, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(disp, mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span>(</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    <span class="dt">data =</span> <span class="kw"><a href="../reference/bootstrapper.html">bootstrapper</a></span>(<span class="dv">20</span>), <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">group =</span> .draw), <span class="dt">size =</span> <span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    <span class="co"># use identical fit parameters as in stat_smooth_draws()</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    <span class="dt">method =</span> <span class="st">"gam"</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/mgcv/topics/s">s</a></span>(x, <span class="dt">bs =</span> <span class="st">"cs"</span>), <span class="dt">method.args =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">method =</span> <span class="st">"REML"</span>),</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    <span class="dt">se =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Bootstrap"</span>)</a>
<a class="sourceLine" id="cb9-17" data-line-number="17"></a>
<a class="sourceLine" id="cb9-18" data-line-number="18">cowplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="posterior-draws_files/figure-html/posterior-draws-bootstrap-1.png" width="576"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Claus O. Wilke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
